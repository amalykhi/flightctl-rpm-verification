#!/bin/bash
# FlightCtl OIDC Verification Configuration File
#
# This file contains all user-defined configuration parameters.
# Edit these values according to your environment.

# ============================================
# VM Configuration
# ============================================

# Libvirt VM name
VM_NAME="eurolinux9"
# VM_NAME="eurolinux9"


# VM SSH credentials
VM_USER="amalykhi"
VM_PASSWORD=" "  # Single space character

# VM Creation Parameters (used if VM doesn't exist)
# TODO:  Set CREATE_VM_IF_MISSING="true" to auto-create VM
CREATE_VM_IF_MISSING="false"

# VM specifications
VM_MEMORY="4096"           # Memory in MB
VM_CPUS="2"                # Number of vCPUs
VM_DISK_SIZE="20"          # Disk size in GB
VM_OS_VARIANT="rhel9.0"    # OS variant for virt-install

# VM installation source
# Options:
#   - URL: http://mirror.example.com/path/to/repo
#   - ISO: /path/to/iso/file.iso
#   - PXE: network boot
VM_INSTALL_SOURCE="https://dl.rockylinux.org/pub/rocky/9/BaseOS/x86_64/os/"

# Network configuration
VM_NETWORK="default"       # Libvirt network name

# Cloud-init configuration (optional)
# If provided, will use cloud-init for automated setup
VM_CLOUD_INIT_USER_DATA=""  # Path to cloud-init user-data file
VM_CLOUD_INIT_META_DATA=""  # Path to cloud-init meta-data file

# Kickstart file (optional)
# If provided, will use kickstart for automated installation
VM_KICKSTART_FILE="/home/amalykhi/RPMs and OIDC/rocky9-kickstart.cfg"       # Path to kickstart file or URL

# ============================================
# FlightCtl RPM Configuration
# ============================================

# RPM source URL or "LATEST" to auto-detect newest build
# Examples:
#   - "LATEST" (recommended - uses Copr builds page: https://copr.fedorainfracloud.org/coprs/g/redhat-et/flightctl-dev/builds/)
#   - Copr URL: "https://download.copr.fedorainfracloud.org/results/@redhat-et/flightctl-dev/epel-9-x86_64/09783358-flightctl/"
#   - Brew task URL: "https://brewweb.engineering.redhat.com/brew/taskinfo?taskID=69283299"
#   - Brew directory URL: "https://download-01.beak-001.prod.iad2.dc.redhat.com/brewroot/vol/rhel-9/packages/flightctl/0.10.0/1.el9em/x86_64/"
#   - Direct RPM URL: "https://download-01.beak-001.prod.iad2.dc.redhat.com/brewroot/vol/rhel-9/packages/flightctl/0.10.0/1.el9em/x86_64/flightctl-services-0.10.0-1.el9em.x86_64.rpm"
RPM_SOURCE="https://download.copr.fedorainfracloud.org/results/@redhat-et/flightctl/epel-9-x86_64/09891919-flightctl/flightctl-services-1.0.0~rc2-1.el9.x86_64.rpm"

# Copr repository configuration (for LATEST detection)
COPR_BUILDS_URL="https://copr.fedorainfracloud.org/coprs/g/redhat-et/flightctl-dev/builds/"
COPR_DOWNLOAD_BASE="https://download.copr.fedorainfracloud.org/results/@redhat-et/flightctl-dev/epel-9-x86_64"

# ============================================
# Authentication Type Configuration
# ============================================

# Authentication type to use
# Options:
#   - "both" (default): Test both PAM Issuer and Keycloak
#   - "pam": Use built-in PAM Issuer only (no external dependencies)
#   - "keycloak": Use external Keycloak OIDC provider only
#   - "none": Disable authentication
AUTH_TYPE="both"

# ============================================
# PAM Issuer Configuration (AUTH_TYPE=pam)
# ============================================

# PAM Issuer user credentials (will be created automatically)
PAM_USER="admin"
PAM_PASSWORD="admin123"

# PAM Issuer role for the user
# Options: flightctl-admin, flightctl-operator, flightctl-viewer, flightctl-installer
PAM_ROLE="flightctl-admin"

# Additional PAM users (optional)
# Format: "username:password:role"
# PAM_USERS=(
#     "operator1:pass1:flightctl-operator"
#     "viewer1:pass2:flightctl-viewer"
# )

# ============================================
# Keycloak Configuration (AUTH_TYPE=keycloak)
# ============================================

# Keycloak admin credentials
KEYCLOAK_ADMIN="admin"
KEYCLOAK_ADMIN_PASSWORD="admin"

# Keycloak ports
KEYCLOAK_PORT="8080"           # Main HTTP port
KEYCLOAK_HEALTH_PORT="9000"    # Health check port

# ============================================
# OIDC Configuration (AUTH_TYPE=keycloak)
# ============================================

# OIDC Realm name
OIDC_REALM="myrealm"

# OIDC Client ID
OIDC_CLIENT_ID="my_client"

# ============================================
# Test User Configuration (AUTH_TYPE=keycloak)
# ============================================

# Test user credentials for Keycloak OIDC authentication
# (Only used when AUTH_TYPE=keycloak)
TEST_USER="testuser"
TEST_PASSWORD="password"
TEST_EMAIL="testuser@example.com"

# Additional test users (optional)
# Format: "username:password:email"
# TEST_USERS=(
#     "user1:pass1:user1@example.com"
#     "user2:pass2:user2@example.com"
# )

# ============================================
# FIPS Configuration
# ============================================

# Enable FIPS mode on the VM
# Options:
#   - "false" (default): Don't modify FIPS settings
#   - "true": Enable FIPS mode (will reboot VM if needed)
#   - "verify": Only verify FIPS status, don't enable
ENABLE_FIPS="false"

# Wait time after FIPS reboot (seconds)
FIPS_REBOOT_WAIT="120"

# ============================================
# Cleanup Options
# ============================================

# Full cleanup before test (ensures fresh state)
# Options:
#   - "true": Remove all FlightCtl data, containers, volumes, Keycloak
#   - "false" (default): Only reinstall RPMs, keep data
FULL_CLEANUP="true"

# ============================================
# Advanced Options
# ============================================

# Enable debug mode (set to "true" for verbose output)
DEBUG_MODE="false"

# Timeout for service startup (seconds)
SERVICE_START_TIMEOUT="15"

# Skip TLS verification (for testing only)
INSECURE_SKIP_TLS_VERIFY="true"

