#version=RHEL9
# Rocky Linux 9 Kickstart Configuration
# Fully automated installation with no user interaction

# System language
lang en_US.UTF-8

# Keyboard layout
keyboard us

# System timezone
timezone America/New_York --utc

# Network configuration
network --bootproto=dhcp --device=eth0 --onboot=yes --ipv6=auto --activate

# Root password (change this in production!)
rootpw --plaintext password

# Create user account with sudo access
user --name=amalykhi --password=password --plaintext --groups=wheel

# System authorization
authselect select sssd --force

# Use text mode install
text

# Do not configure X Window System
skipx

# System bootloader configuration
bootloader --location=mbr --boot-drive=vda

# Clear the Master Boot Record
zerombr

# Partition clearing information
clearpart --all --initlabel --drives=vda

# Disk partitioning information
part /boot --fstype=xfs --size=1024 --ondisk=vda
part pv.01 --fstype=lvmpv --size=1 --grow --ondisk=vda

volgroup vg_root pv.01
logvol / --fstype=xfs --name=lv_root --vgname=vg_root --size=1 --grow
logvol swap --fstype=swap --name=lv_swap --vgname=vg_root --size=2048

# System services
services --enabled=sshd,NetworkManager

# Firewall configuration
firewall --enabled --ssh

# SELinux configuration
selinux --enforcing

# Reboot after installation
reboot

# Package selection
%packages
@^minimal-environment
openssh-server
sudo
curl
wget
vim
%end

# Post-installation script
%post --log=/root/ks-post.log

# Enable passwordless sudo for wheel group
echo "%wheel ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers.d/wheel
chmod 0440 /etc/sudoers.d/wheel

# Enable SSH password authentication
sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config
sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/' /etc/ssh/sshd_config

# Set hostname
hostnamectl set-hostname eurolinux9-test

# Enable and start sshd
systemctl enable sshd
systemctl start sshd

%end

